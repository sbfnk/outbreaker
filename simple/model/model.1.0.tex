% Template for PLoS
% Version 1.0 January 2009
%
% To compile to pdf, run:
% latex plos.template
% bibtex plos.template
% latex plos.template
% latex plos.template
% dvipdf plos.template

\documentclass[10pt]{article}

% amsmath package, useful for mathematical formulas
\usepackage{amsmath}
% amssymb package, useful for mathematical symbols
\usepackage{amssymb}

% graphicx package, useful for including eps and pdf graphics
% include graphics with the command \includegraphics
\usepackage{graphicx}

% cite package, to clean up citations in the main text. Do not remove.
\usepackage{cite}

\usepackage{color} 

% Use doublespacing - comment out for single spacing
%\usepackage{setspace} 
%\doublespacing

\usepackage[frenchb,english]{babel}
\usepackage{bm}
\usepackage{cite}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{ccaption}
\usepackage{url}

% Text layout
\topmargin 0.0cm
\oddsidemargin 0.5cm
\evensidemargin 0.5cm
\textwidth 16cm 
\textheight 21cm

% Bold the 'Figure #' in the caption and separate it with a period
% Captions will be left justified
\usepackage[labelfont=bf,labelsep=period,justification=raggedright]{caption}

% Remove brackets from numbering in List of References
\makeatletter
\renewcommand{\@biblabel}[1]{\quad#1.}
\makeatother

\author{In alphabetic order: \\Simon Cauchemez, Anne Cori, Xavier Didelot, \\Neil Ferguson, Christophe Fraser, Thibaut Jombart,\\...}
\title{Reconstructing transmission trees from genetic data: \\a Bayesian approach}

\begin{document}

% Title must be 150 words or less
% \begin{flushleft}
\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Purpose of the model}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
We seek a probabilistic model allowing to reconstruct the transmission tree of a disease outbreak based on RNA/DNA sequences sampled at given time points.
We consider a single pathogen and genetic sequence per infection.
The generation time is assumed to follow a known distribution.
The transmission tree and the mutation rates are the quantities we want to infer.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Data and parameters}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Data}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
For each patient $i=1,\ldots,n$ we note the data:
\begin{itemize}
	\item $s_i$: the genetic sequence obtained for patient $i$
	\item $t_i$: the collection time for $s_i$
 	\item $d_{i,j}$: the number of transitions between $s_i$ and $s_j$
 	\item $g_{i,j}$: the number of transversions between $s_i$ and $s_j$
 	\item $l_{i,j}$: the number of nucleotide positions typed in both $s_i$ and $s_j$
 	\item $w(\Delta_t)$: likelihood function for a secondary infection occuring $\Delta_t$ unit times after the primary infection; we assume $w(\Delta_t)=0$ for $\Delta_t \leq 0$.
\end{itemize}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Augmented data}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Augmented data are noted using capital latin letters:
\begin{itemize}
	\item $T_i^{inf}$: time at which patient $i$ has been infected
	\item $A_i$: the infector of $i$; $A_i=j$ indicates that $j$ has infected $i$
\end{itemize}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Parameters}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Parameters are indicated using greek letters:
\begin{itemize}
	\item $\mu_1$: rates of transitions.
	\item $\mu_2 $: rate of transversions, assumed proportional to $\mu_1$ so that $\mu_2 = \kappa \mu_1$.
\end{itemize}






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Basic model}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
This model assumes that all ancestries have been sampled.
The posterior distribution for patient $i$ is proportional to the joint distribution:
\begin{equation}
 p(s_i, t_i, T_i^{inf}, A_i, w, \mu_1, \mu_2)
\end{equation}
which can be decomposed in:
\begin{eqnarray}
& & p(s_i | t_i, T_i^{inf}, A_i, w, \mu_1, \mu_2)  p(t_i, T_i^{inf}, A_i, w, \mu_1, \mu_2)\\
&=& p(s_i | t_i, T_i^{inf}, A_i, w, \mu_1, \mu_2)  p(T_i^{inf} | t_i, A_i, w, \mu_1, \mu_2) p(t_i, A_i, w, \mu_1, \mu_2)\\
&=& \underbrace{p(s_i | t_i, T_i^{inf}, A_i, \mu_1, \mu_2)}_{\Omega_1}  
    \underbrace{p(T_i^{inf} | A_i, w)}_{\Omega_2}
    \underbrace{p(t_i, A_i, w, \mu_1, \mu_2)}_{\Omega_3} 
\end{eqnarray}
\noindent where $\Omega_1$ is the genetic likelihood, $\Omega_2$ if the epidemiological likelihood (from W\&T), and $\Omega_3$ is mixture of constants and priors.
\\




$\Omega_1$ is computed as: 
$$
\underbrace{\mathcal{P}\left(d_{i,A_i} | (t_i - t_{A_i}) l_{i,A_i} \mu_1 \right)}_{\mbox{transitions}}
\times 
\underbrace{\mathcal{P}\left(g_{i,A_i} | (t_i - t_{A_i}) l_{i,A_i} \mu_2 \right)}_{\mbox{transversions}}
$$
if $t_{A_i} \leq T_i^{inf} $, and as:
$$
\underbrace{\mathcal{P}\left(d_{i,A_i} | (t_{A_i} - T_i^{inf} + t_i - T_i^{inf}) l_{i,A_i} \mu_1 \right)}_{\mbox{transitions}}
\times 
\underbrace{\mathcal{P}\left(g_{i,A_i} | (t_{A_i} - T_i^{inf} + t_i - T_i^{inf}) l_{i,A_i} \mu_2 \right)}_{\mbox{transversions}}
$$
otherwise; $\mathcal{P}(. | \lambda)$ is the density of a Poisson distribution of parameter $\lambda$.
~\\

%% BINOMIAL VERSION %%
% $$
% \underbrace{\mathcal{B}\left(d_{i,A_i} | (t_i - t_{A_i}) l_{i,A_i}, \mu_1 \right)}_{\mbox{transitions}}
% \times 
% \underbrace{\mathcal{B}\left(g_{i,A_i} | (t_i - t_{A_i}) l_{i,A_i}, \mu_2 \right)}_{\mbox{transversions}}
% $$
% if $t_{A_i} \leq T_i^{inf} $, and as:
% $$
% \underbrace{\mathcal{B}\left(d_{i,A_i} | (t_{A_i} - T_i^{inf} + t_i - T_i^{inf}) l_{i,A_i}, \mu_1 \right)}_{\mbox{transitions}}
% \times 
% \underbrace{\mathcal{B}\left(g_{i,A_i} | (t_{A_i} - T_i^{inf} + t_i - T_i^{inf}) l_{i,A_i}, \mu_2 \right)}_{\mbox{transversions}}
% $$
% otherwise, with $\mathcal{B}(. | n, p)$ being the probability mass function of a Binomial distribution with $n$ draws and a probability $p$.
% ~\\




$\Omega_2$ is defined by the (known) distribution of the generation time:
$$
\Omega_2 = \frac{w(t_i - t_{A_i})}{\sum_{k=1}^n w(t_i - t_{A_k})} 
$$
~\\



The term $\Omega_3$ can be rewritten:
\begin{eqnarray}
\Omega_3 &=&  p(t_i, A_i, w, \mu_1, \mu_2) \\
	 &=&  p(t_i, w) p(A_i, \mu_1, \mu_2) \\
	 &=&  p(t_i, w) p(A_i) p(\mu_1) p(\kappa) 
\end{eqnarray}
as the different components are independent.
$p(t_i, w)$ is a constant and does not need to be known to sample from (1).
$p(A_i)$ is the prior on ancestries, set to $1/(n-1)$.
$ p(\mu_1)$ and $p(\kappa)$ are the priors for the mutations rates.

The global posterior distribution is proportional to the product of (1) over all individuals:
\begin{eqnarray}
\prod_{i=1}^n p(s_i, t_i, T_i^{inf}, A_i, w, \mu_1, \mu_2)
\end{eqnarray}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Model with missing data}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!!! Need to work on that one. 

The basic model can be extended to incorporate the fact that some infectors have not been sampled, and therefore some infections cannot be reconstructed.
% This will be modeled by $A_i=0$ when $i$'s infector has not been observed. 
We introduce the parameter $\pi$, which is the probability of having observed the infector of a given case.
Then the expression (1) becomes:
\begin{equation}
 p(s_i, t_i, T_i^{inf}, A_i, w, \mu_1, \mu_2, \pi)
\end{equation}
which can be decomposed in:
\begin{eqnarray}
& & p(s_i | t_i, T_i^{inf}, A_i, w, \mu_1, \mu_2, \pi)  p(t_i, T_i^{inf}, A_i, w, \mu_1, \mu_2, \pi)\\
&=& p(s_i | t_i, T_i^{inf}, A_i, w, \mu_1, \mu_2, \pi)  p(T_i^{inf} | t_i, A_i, w, \mu_1, \mu_2, \pi) p(t_i, A_i, w, \mu_1, \mu_2, \pi)\\
&=& \underbrace{p(s_i | t_i, T_i^{inf}, A_i, \mu_1, \mu_2, \pi)}_{\Omega^*_1}  
    \underbrace{p(T_i^{inf} | A_i, w, \pi)}_{\Omega^*_2}
    \underbrace{p(t_i, A_i, w, \mu_1, \mu_2, \pi)}_{\Omega^*_3} 
\end{eqnarray}
The first two terms are simply given by $\Omega^*_1 = \pi \Omega_1$ and $\Omega^*_2 = \pi \Omega_2$

% 
% 
% 
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \subsection*{Prior level}
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%
% 
% For all model parameters, independent prior distributions were chosen: 
% \begin{itemize}
% 	\item uniform on $[0,1]$ for $\psi$, $\phi$, $\pi$, $\nu_1$ and $\nu_2$
% 	\item uniform on $[0,100]$ for $\kappa$ 
% 	\item uniform on $[0-1000]$ for $\mu_{\alpha}$
% 	\item flat exponential (mean 1000) for all other parameters. 
% \end{itemize}
% 
%   
% \section*{Parameter Estimation}
% 
% A Markov chain Monte Carlo (MCMC) method was used to sample the joint
% posterior distribution $P\left(\bm{Y},\bm{Z},\bm{\theta}\right)$.
% $\psi$, $\phi$ and $\pi$ were updated using the Gibbs sampler, and all other parameters using a Metropolis algorithm.



\end{document}

